## Быстрые победы (QUICK WINS)

### 1. Структура роутов и устранение дублей

- **Убрать дубли в `well_equipment_integration.py`**  
  - Оставить один обработчик для каждого пути, удалить вторые определения (`/api/wells/{well_id}/install-equipment` и др.).  
  - Для маршрутов, полностью дублирующих `equipment_management.py` (`/equipment/add`, `/equipment`, `/api/equipment/{id}/*`), либо:
    - удалить их из интеграционного роутера, либо
    - перенаправить вызовы на общий сервисный слой, чтобы логика была единой.

- **Явно разделить web‑роуты и API по оборудованию**  
  - Для человеко‑ориентированных страниц использовать только `/equipment`, `/equipment/view/{id}` (`equipment_management.py`).  
  - В интеграционном роутере оставить только действительно новые API‑пути (по связи скважина↔оборудование).

### 2. Наведение порядка в `app.py`

- **Вытащить крупные доменные блоки в отдельные модули**:
  - Блок управления пользователями (`/admin/users/*`) → `routers/admin_users.py` + `services/user_admin_service.py`.
  - Блок учёта реагентов (`/admin/reagents*`) → `routers/reagents_admin.py`, логика на базе `ReagentBalanceService` и репозитория.
  - Блок страницы скважины (`/well/*`, `/api/well/*`) → `routers/wells_web.py` + `services/well_service.py`.

- **Сделать `app.py` тонкой «обвязкой»**:
  - оставить создание `FastAPI`, middleware, `include_router` и минимум общих вспомогательных функций;
  - убрать SQLAlchemy‑запросы и форму‑разбор из тела эндпойнтов в сервисы.

### 3. Документы и LaTeX

- **Вынести генерацию PDF в отдельный сервисный слой**  
  - Создать модуль `documents/services/pdf_builder.py`, инкапсулирующий:
    - чтение LaTeX‑шаблонов;
    - подстановку переменных/таблиц;
    - вызов `xelatex` и обработку ошибок/логов;
    - формирование путей к файлам.  
  - В роутерах (`documents_pages.py`, `documents_well_handover.py`, `equipment_documents.py`) оставить только передачу `doc`/`meta` в сервис и редирект по результату.

- **Стандартизировать хранение метаданных документа**  
  - Привести использование `doc.meta`/`metadata` к одному названию и единому формату (dict со схемой).  
  - Добавить тонкий pydantic‑слой/TypedDict для `meta` по типам документов (well_handover, equipment_act, reagent_expense).

### 4. Учёт реагентов и API

- **Унифицировать логику реагентов**  
  - Перенести функции `_get_or_create_catalog_item`, `_resolve_reagent_from_form`, `_parse_datetime_local_to_db_naive`, `_form_get_str` в модуль сервиса (`services/reagent_form_service.py`).  
  - Использовать их как из HTML‑форм (`/admin/reagents/*`), так и из JSON‑API (`/api/reagents`), чтобы исключить расхождения.

- **Документировать и стабилизировать публичное API**  
  - Чётко зафиксировать, какие эндпойнты являются внешними (`/api/reagents`, `/api/wells`, возможно часть `/api/equipment/*`).  
  - Для остальных API без явных внешних пользователей (например, `/api/equipment/add`) либо:
    - привязать использование к фронтенду (JS/шаблоны),
    - либо задепрекейтить и удалить.

### 5. Улучшение фронтенда и UX

- **Централизация настроек цветов графиков**  
  - Сейчас логика сохранения цветов разнесена по `reagents.js`, `visual_timeline.js`, `well_events_chart.js`.  
  - Имеет смысл:
    - вынести словари `reagentColors`/`eventColors` и чтение `localStorage` в общий мини‑модуль (например, `static/js/colors.js`);
    - использовать его во всех трёх скриптах, чтобы избежать рассинхронизации.

- **Упрощение легенд и фильтров**  
  - Легенды (особенно в `reagents.js` и `visual_timeline.js`) очень мощные, но сложные; быстрый выигрыш – добавить:
    - подсказки (tooltip’ы) рядом с чекбоксами/поиском;
    - ограничение высоты / «свернуть/развернуть» для длинных списков скважин/реагентов.

### 6. Технический долг и поддерживаемость

- **Документация карты роутов**  
  - Использовать `ROUTES_MAP.md` как живой документ: при добавлении новых роутов – обновлять таблицу (либо сгенерировать автоматом скриптом на основе `app.routes`).  
  - Это поможет избежать новых скрытых дублей и упростит онбординг.

- **Явное разделение окружений**  
  - Диагностические/отладочные маршруты (`/debug/*`, `admin/equipment/test-*`) скрыть за проверкой окружения (например, `settings.DEBUG`) или флагом, чтобы в продакшене интерфейс был чище и безопаснее.

Эти шаги можно реализовывать поэтапно, начиная с удаления дублей и вынесения наиболее объёмных кусков логики из `app.py` и проблемных роутеров – это сразу уменьшит сложность и снизит риск ошибок при дальнейших изменениях.

