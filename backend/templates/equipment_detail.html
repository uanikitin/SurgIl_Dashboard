{% extends "base.html" %}

{% block title %}–°–£–†–ì–ò–õ ¬∑ {{ equipment.name }}{% endblock %}

{% block extra_head %}
<style>
.equipment-detail { padding: 20px; max-width: 1200px; margin: 0 auto; }
.breadcrumb { display: flex; gap: 8px; margin-bottom: 20px; font-size: 14px; color: #6c757d; }
.breadcrumb a { color: #007bff; text-decoration: none; }
.header { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 30px; }
.header h1 { margin: 0 0 10px 0; font-size: 28px; }
.header-actions { display: flex; gap: 10px; margin-top: 20px; }
.btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; }
.btn-success { background: #28a745; color: white; }
.btn-danger { background: #dc3545; color: white; }
.current-status { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px; }
.status-item { display: flex; flex-direction: column; gap: 4px; }
.status-item__label { font-size: 12px; color: #6c757d; text-transform: uppercase; }
.status-item__value { font-size: 16px; font-weight: 600; }
.section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 30px; }
.section h2 { font-size: 20px; margin: 0 0 20px 0; padding-bottom: 15px; border-bottom: 2px solid #f1f3f5; }
.timeline { position: relative; padding-left: 30px; }
.timeline::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 2px; background: #dee2e6; }
.timeline-item { position: relative; margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff; }
.timeline-item--active { border-left-color: #28a745; background: #d4edda; }
.timeline-item::before { content: ''; position: absolute; left: -26px; top: 20px; width: 12px; height: 12px; border-radius: 50%; background: white; border: 3px solid #007bff; }
.timeline-item--active::before { border-color: #28a745; background: #28a745; }
.timeline-item h3 { margin: 0 0 8px 0; font-size: 16px; }
.timeline-item__date { font-size: 13px; color: #6c757d; margin-bottom: 8px; }
.timeline-item__meta { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); font-size: 13px; }
.empty { text-align: center; padding: 40px; color: #6c757d; }
.stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; }
.stat { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; }
.stat__value { font-size: 32px; font-weight: 700; color: #007bff; }
.stat__label { font-size: 12px; color: #6c757d; text-transform: uppercase; }
</style>
{% endblock %}

{% block content %}
<div class="equipment-detail">
    
    <div class="breadcrumb">
        <a href="/visual">üìä –î–∞—à–±–æ—Ä–¥</a> ‚Ä∫ 
        <a href="/equipment">üîß –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è</a> ‚Ä∫ 
        <span>{{ equipment.name }}</span>
    </div>

    <div class="header">
        <h1>{{ equipment.name }}</h1>
        <div>–°–µ—Ä—ñ–π–Ω–∏–π ‚Ññ: <strong>{{ equipment.serial_number or '‚Äî' }}</strong></div>
        
        <div class="current-status">
            <div class="status-item">
                <div class="status-item__label">–°—Ç–∞—Ç—É—Å</div>
                <div class="status-item__value">
                    {% if equipment.status == 'installed' %}üü¢ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                    {% elif equipment.status == 'available' %}üì¶ –ù–∞ —Å–∫–ª–∞–¥—ñ
                    {% else %}{{ equipment.status }}{% endif %}
                </div>
            </div>
            <div class="status-item">
                <div class="status-item__label">–°—Ç–∞–Ω</div>
                <div class="status-item__value">
                    {% if equipment.condition == 'working' %}‚úÖ –†–æ–±–æ—á–µ
                    {% elif equipment.condition == 'broken' %}‚ùå –ù–µ —Ä–æ–±–æ—á–µ
                    {% else %}{{ equipment.condition }}{% endif %}
                </div>
            </div>
            <div class="status-item">
                <div class="status-item__label">–õ–æ–∫–∞—Ü—ñ—è</div>
                <div class="status-item__value">{{ equipment.current_location or '‚Äî' }}</div>
            </div>
            {% if current_installation %}
            <div class="status-item">
                <div class="status-item__label">–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
                <div class="status-item__value">
                    {{ current_installation.installed_at.strftime('%d.%m.%Y') }}
                    <br><small>({{ current_installation.duration_days }} –¥–Ω—ñ–≤)</small>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="header-actions">
            {% if equipment.status == 'available' %}
            <a href="/documents/equipment/new?equipment_id={{ equipment.id }}&kind=install" class="btn btn-success">
                ‚ÜóÔ∏è –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ (–∑ –∞–∫—Ç–æ–º)
            </a>
            {% elif equipment.status == 'installed' and current_installation %}
            <a href="/documents/equipment/new?equipment_id={{ equipment.id }}&well_id={{ current_installation.well_id }}&kind=removal" class="btn btn-danger">
                ‚ÜôÔ∏è –î–µ–º–æ–Ω—Ç—É–≤–∞—Ç–∏ (–∑ –∞–∫—Ç–æ–º)
            </a>
            {% endif %}
            <button class="btn btn-warning" onclick="showMaintenanceModal()">
                üîß –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
            </button>
            <button class="btn" style="background: #17a2b8; color: white;" onclick="showStatusModal()">
                ‚öôÔ∏è –ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
            </button>
            <button class="btn" style="background: #6c757d; color: white;" onclick="showMoveModal()">
                üì¶ –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –±–µ–∑ –∞–∫—Ç—É
            </button>
            <button class="btn" style="background: #0d6efd; color: white;" onclick="showEditModal()">
    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="btn" style="background: #dc3545; color: white;" onclick="if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è?')) deleteEquipment()">
                üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
            </button>
        </div>
    </div>

    <div class="section">
    <h2>üìä –Ü—Å—Ç–æ—Ä—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—å</h2>
    {% if installation_history %}
    <div class="timeline">
        {% for inst in installation_history %}
        <div class="timeline-item {% if inst.is_active %}timeline-item--active{% endif %}">
            <!-- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô -->
            <div style="position: absolute; top: 10px; right: 10px; display: flex; gap: 8px;">
                {% if not inst.is_active %}
                <!-- –ò–ö–û–ù–ö–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π) -->
                <button class="edit-installation-btn"
                        onclick="editInstallationRecord({{ inst.id }})"
                        style="background: #007bff; color: white; border: none; cursor: pointer; font-size: 14px; padding: 6px 10px; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;"
                        title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å">
                    ‚úèÔ∏è
                </button>

                <!-- –ò–ö–û–ù–ö–ê –£–î–ê–õ–ï–ù–ò–Ø (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π) -->
                <button class="delete-installation-btn"
                        onclick="deleteInstallationRecord({{ inst.id }}, '{{ inst.well_number }}')"
                        style="background: #dc3545; color: white; border: none; cursor: pointer; font-size: 14px; padding: 6px 10px; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;"
                        title="–í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å">
                    üóëÔ∏è
                </button>
                {% endif %}
            </div>

            <h3>
                {% if inst.is_active %}üü¢{% else %}‚ö™{% endif %}
                –°–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞ {{ inst.well_number }}
                {% if inst.is_active %}<span style="color: #28a745;">(–∑–∞—Ä–∞–∑)</span>{% endif %}
            </h3>
            <div class="timeline-item__date">
                {{ inst.installed_at.strftime('%d.%m.%Y %H:%M') }}
                {% if inst.removed_at %}‚Üí {{ inst.removed_at.strftime('%d.%m.%Y %H:%M') }}{% else %}‚Üí –∑–∞—Ä–∞–∑{% endif %}
                | ‚è± {{ inst.duration_days }} –¥–Ω—ñ–≤
            </div>
            <div class="timeline-item__meta">
                <div>–í—Å—Ç–∞–Ω–æ–≤–∏–≤: <strong>{{ inst.installed_by or '‚Äî' }}</strong></div>
                {% if inst.installation_location %}<div>–ú—ñ—Å—Ü–µ: <strong>{{ inst.installation_location }}</strong></div>{% endif %}
                {% if inst.removed_by %}<div>–ó–Ω—è–≤: <strong>{{ inst.removed_by }}</strong></div>{% endif %}
            </div>

            {% if inst.has_document %}
            <div style="margin-top: 10px;">
                üìÑ <a href="/documents/{{ inst.document_id }}" target="_blank">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞–∫—Ç</a>
            </div>
            {% elif not inst.no_document_confirmed %}
            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px; font-size: 13px;">
                ‚ö†Ô∏è <strong>–ë–ï–ó –ê–ö–¢–£</strong> ‚Äî –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
                {% if inst.is_active %}
                <a href="/documents/equipment/new?equipment_id={{ equipment.id }}&well_id={{ inst.well_id }}&kind=install">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫—Ç –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</a>
                {% else %}
                <a href="/documents/equipment/new?equipment_id={{ equipment.id }}&well_id={{ inst.well_id }}&kind=removal">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫—Ç –¥–µ–º–æ–Ω—Ç–∞–∂—É</a>
                {% endif %}
            </div>
            {% endif %}

            {% if inst.notes %}
            <div style="margin-top: 10px; font-size: 13px; color: #6c757d;">
                –ü—Ä–∏–º—ñ—Ç–∫–∞: {{ inst.notes }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">üìã –Ü—Å—Ç–æ—Ä—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—å –≤—ñ–¥—Å—É—Ç–Ω—è</div>
    {% endif %}
</div>

<div class="section">
    <h2>üîß –Ü—Å—Ç–æ—Ä—ñ—è –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</h2>
    {% if maintenance_history %}
    <div style="display: grid; gap: 15px;">
        {% for maint in maintenance_history %}
<div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8; position: relative;">
    <!-- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô -->
    <div style="position: absolute; top: 10px; right: 10px; display: flex; gap: 8px;">
        <!-- –ò–ö–û–ù–ö–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
        <button class="edit-maintenance-btn"
                onclick="editMaintenanceRecord({{ maint.id }})"
                style="background: #007bff; color: white; border: none; cursor: pointer; font-size: 14px; padding: 6px 10px; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;"
                title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å">
            ‚úèÔ∏è
        </button>

        <!-- –ò–ö–û–ù–ö–ê –£–î–ê–õ–ï–ù–ò–Ø -->
        <button class="delete-maintenance-btn"
                onclick="deleteMaintenanceRecord({{ maint.id }}, '{{ maint.maintenance_type }}')"
                style="background: #dc3545; color: white; border: none; cursor: pointer; font-size: 14px; padding: 6px 10px; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;"
                title="–í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å">
            üóëÔ∏è
        </button>
    </div>

    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-right: 90px;">
        <strong>{{ maint.maintenance_type }}</strong>
        <span style="font-size: 13px; color: #6c757d;">{{ maint.maintenance_date.strftime('%d.%m.%Y %H:%M') }}</span>
    </div>
    <div style="margin-bottom: 8px; padding-right: 90px;">{{ maint.description }}</div>
    <div style="display: flex; justify-content: space-between; font-size: 13px; color: #6c757d; padding-right: 90px;">
        <div>–í–∏–∫–æ–Ω–∞–≤: {{ maint.performed_by }}</div>
        {% if maint.cost %}<div style="font-weight: 600; color: #28a745;">{{ "{:,.2f}".format(maint.cost) }} –≥—Ä–Ω</div>{% endif %}
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    {% if maint.issues_found or maint.actions_taken or maint.notes %}
    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #dee2e6; font-size: 13px; padding-right: 90px;">
        {% if maint.issues_found %}
        <div><strong>–ü—Ä–æ–±–ª–µ–º–∏:</strong> {{ maint.issues_found }}</div>
        {% endif %}
        {% if maint.actions_taken %}
        <div><strong>–ó–∞—Ö–æ–¥–∏:</strong> {{ maint.actions_taken }}</div>
        {% endif %}
        {% if maint.notes %}
        <div><strong>–ü—Ä–∏–º—ñ—Ç–∫–∏:</strong> {{ maint.notes }}</div>
        {% endif %}
    </div>
    {% endif %}
</div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">üîß –ó–∞–ø–∏—Å—ñ–≤ –ø—Ä–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –Ω–µ–º–∞—î</div>
    {% endif %}
</div>

    <div class="section">
        <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stats">
            <div class="stat">
                <div class="stat__value">{{ stats.total_installations }}</div>
                <div class="stat__label">–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—å</div>
            </div>
            <div class="stat">
                <div class="stat__value">{{ stats.total_days }}</div>
                <div class="stat__label">–î–Ω—ñ–≤ –Ω–∞ —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞—Ö</div>
            </div>
            <div class="stat">
                <div class="stat__value">{{ "{:,.0f}".format(stats.total_maintenance_cost) }}</div>
                <div class="stat__label">–í–∞—Ä—Ç—ñ—Å—Ç—å –¢–û (–≥—Ä–Ω)</div>
            </div>
            <div class="stat">
                <div class="stat__value">{{ stats.avg_days_per_installation }}</div>
                <div class="stat__label">–°–µ—Ä–µ–¥–Ω—è —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</div>
            </div>
        </div>
    </div>

</div>

<!-- –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê -->
<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø -->
<div id="edit-maintenance-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
        <h2 style="margin: 0 0 20px 0;">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</h2>
        <form id="edit-maintenance-form" onsubmit="submitEditMaintenance(event)">
            <input type="hidden" id="edit-maintenance-id" name="maintenance_id" value="">

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–¢–∏–ø *</label>
                <select id="edit-maintenance-type" name="maintenance_type" required
                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    <option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø...</option>
                    <option value="–¢–µ—Ö–Ω—ñ—á–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è">–¢–µ—Ö–Ω—ñ—á–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è (–¢–û)</option>
                    <option value="–†–µ–º–æ–Ω—Ç">–†–µ–º–æ–Ω—Ç</option>
                    <option value="–ö–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è">–ö–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è</option>
                    <option value="–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞">–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</option>
                    <option value="–ó–∞–º—ñ–Ω–∞ –¥–µ—Ç–∞–ª–µ–π">–ó–∞–º—ñ–Ω–∞ –¥–µ—Ç–∞–ª–µ–π</option>
                    <option value="–ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è">–ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è</option>
                    <option value="–†–æ–∑–∫–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è">–†–æ–∑–∫–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è</option>
                </select>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–û–ø–∏—Å —Ä–æ–±—ñ—Ç *</label>
                <textarea id="edit-description" name="description" required rows="3"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–©–æ —Å–∞–º–µ –±—É–ª–æ –∑—Ä–æ–±–ª–µ–Ω–æ..."></textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–î–∞—Ç–∞ *</label>
                    <input type="datetime-local" id="edit-maintenance-date" name="maintenance_date" required
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ù–∞—Å—Ç—É–ø–Ω–µ –¢–û</label>
                    <input type="date" id="edit-next-date" name="next_maintenance_date"
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å</label>
                    <input type="text" id="edit-performed-by" name="performed_by" placeholder="–Ü–º'—è –≤–∏–∫–æ–Ω–∞–≤—Ü—è"
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–í–∞—Ä—Ç—ñ—Å—Ç—å (–≥—Ä–Ω)</label>
                    <input type="number" id="edit-cost" name="cost" step="0.01" value="0"
                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ó–Ω–∞–π–¥–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏</label>
                <textarea id="edit-issues" name="issues_found" rows="2"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–Ø–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏ –±—É–ª–∏ –≤–∏—è–≤–ª–µ–Ω—ñ..."></textarea>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–í–∂–∏—Ç—ñ –∑–∞—Ö–æ–¥–∏</label>
                <textarea id="edit-actions" name="actions_taken" rows="2"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–Ø–∫—ñ –∑–∞—Ö–æ–¥–∏ –±—É–ª–∏ –≤–∂–∏—Ç—ñ..."></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ü—Ä–∏–º—ñ—Ç–∫–∏</label>
                <textarea id="edit-notes" name="notes" rows="2"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏..."></textarea>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeEditMaintenanceModal()"
                        style="padding: 10px 20px; border: none; border-radius: 8px; background: #6c757d; color: white; font-weight: 600; cursor: pointer;">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
                <button type="submit"
                        style="padding: 10px 20px; border: none; border-radius: 8px; background: #28a745; color: white; font-weight: 600; cursor: pointer;">
                    –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
                </button>
            </div>
        </form>
    </div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="edit-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
        <h2 style="margin: 0 0 20px 0;">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h2>
        <form id="edit-form" onsubmit="submitEdit(event)">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ù–∞–∑–≤–∞ *</label>
                    <input type="text" name="name" value="{{ equipment.name }}" required
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–¢–∏–ø –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</label>
                    <input type="text" name="equipment_type" value="{{ equipment.equipment_type or '' }}"
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–°–µ—Ä—ñ–π–Ω–∏–π –Ω–æ–º–µ—Ä</label>
                    <input type="text" name="serial_number" value="{{ equipment.serial_number or '' }}"
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–í–∏—Ä–æ–±–Ω–∏–∫</label>
                    <input type="text" name="manufacturer" value="{{ equipment.manufacturer or '' }}"
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–î–∞—Ç–∞ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞</label>
                    <input type="date" name="manufacture_date"
                           value="{{ equipment.manufacture_date.strftime('%Y-%m-%d') if equipment.manufacture_date else '' }}"
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–°—Ç–∞–Ω</label>
                    <select name="condition" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                        <option value="working" {% if equipment.condition == 'working' %}selected{% endif %}>‚úÖ –†–æ–±–æ—á–µ</option>
                        <option value="needs_repair" {% if equipment.condition == 'needs_repair' %}selected{% endif %}>‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É</option>
                        <option value="broken" {% if equipment.condition == 'broken' %}selected{% endif %}>‚ùå –ù–µ —Ä–æ–±–æ—á–µ</option>
                    </select>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–û–ø–∏—Å</label>
                <textarea name="description" rows="3"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">{{ equipment.description or '' }}</textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ü—Ä–∏–º—ñ—Ç–∫–∏</label>
                <textarea name="notes" rows="2"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">{{ equipment.notes or '' }}</textarea>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeEditModal()"
                        style="padding: 10px 20px; border: none; border-radius: 8px; background: #6c757d; color: white; font-weight: 600; cursor: pointer;">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
                <button type="submit"
                        style="padding: 10px 20px; border: none; border-radius: 8px; background: #0d6efd; color: white; font-weight: 600; cursor: pointer;">
                    –ó–±–µ—Ä–µ–≥—Ç–∏
                </button>
            </div>
        </form>
    </div>
</div>
<!-- –ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É/—Å—Ç–∞–Ω—É -->
<div id="status-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%;">
        <h2 style="margin: 0 0 20px 0;">‚öôÔ∏è –ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h2>
        <form id="status-form" onsubmit="submitStatus(event)">

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ù–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å *</label>
                <select name="new_status" required style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    <option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—É—Å...</option>
                    <option value="available">üì¶ –ù–∞ —Å–∫–ª–∞–¥—ñ</option>
                    <option value="installed">üü¢ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</option>
                    <option value="maintenance">üîß –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è/–†–µ–º–æ–Ω—Ç</option>
                    <option value="broken">‚ùå –ó–ª–∞–º–∞–Ω–æ</option>
                    <option value="lost">üîç –í—Ç—Ä–∞—á–µ–Ω–æ</option>
                </select>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–°—Ç–∞–Ω –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</label>
                <select name="new_condition" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    <option value="">–ù–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏</option>
                    <option value="working">‚úÖ –†–æ–±–æ—á–µ</option>
                    <option value="broken">‚ùå –ù–µ —Ä–æ–±–æ—á–µ</option>
                    <option value="needs_repair">‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É</option>
                </select>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ö—É–¥–∏ –ø–µ—Ä–µ–º—ñ—â—É—î—Ç—å—Å—è</label>
                <select name="new_location" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;" onchange="if(this.value==='custom') this.nextElementSibling.style.display='block'; else this.nextElementSibling.style.display='none';">
                    <option value="">–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (–∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º)</option>
                    <option value="–°–∫–ª–∞–¥">üì¶ –°–∫–ª–∞–¥</option>
                    <option value="–ú–∞–π—Å—Ç–µ—Ä–Ω—è">üîß –ú–∞–π—Å—Ç–µ—Ä–Ω—è (—Ä–µ–º–æ–Ω—Ç)</option>
                    <option value="–ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è">‚ùÑÔ∏è –ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è</option>
                    <option value="–°–ø–∏—Å–∞–Ω–æ">üóëÔ∏è –°–ø–∏—Å–∞–Ω–æ</option>
                    <option value="custom">‚úèÔ∏è –Ü–Ω—à–µ (–≤–∫–∞–∑–∞—Ç–∏)</option>
                </select>
                <input type="text" id="custom-location" placeholder="–í–∫–∞–∂—ñ—Ç—å –ª–æ–∫–∞—Ü—ñ—é..." style="display: none; width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px; margin-top: 10px;">
            </div>

            <div style="padding: 15px; background: #e7f3ff; border-left: 4px solid #007bff; border-radius: 6px; margin: 20px 0; font-size: 14px;">
                <strong>‚ÑπÔ∏è –ü—ñ–¥–∫–∞–∑–∫–∞:</strong><br>
                ‚Ä¢ <strong>–ù–∞ —Å–∫–ª–∞–¥—ñ</strong> ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ "–°–∫–ª–∞–¥"<br>
                ‚Ä¢ <strong>–û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è/–†–µ–º–æ–Ω—Ç</strong> ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ "–ú–∞–π—Å—Ç–µ—Ä–Ω—è"<br>
                ‚Ä¢ <strong>–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</strong> ‚Üí –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –ø–æ—Ç–æ—á–Ω–∞ –ª–æ–∫–∞—Ü—ñ—è<br>
                ‚Ä¢ –Ø–∫—â–æ –∞–∫—Ç–∏–≤–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω—ñ - –≤–æ–Ω–∞ –±—É–¥–µ –∑–∞–∫—Ä–∏—Ç–∞
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ü—Ä–∏–º—ñ—Ç–∫–∞</label>
                <textarea name="notes" rows="2" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –∑–º—ñ–Ω–∏ —Å—Ç–∞—Ç—É—Å—É..." style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"></textarea>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeStatusModal()" style="padding: 10px 20px; border: none; border-radius: 8px; background: #6c757d; color: white; font-weight: 600; cursor: pointer;">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
                <button type="submit" style="padding: 10px 20px; border: none; border-radius: 8px; background: #007bff; color: white; font-weight: 600; cursor: pointer;">
                    –ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
                </button>
            </div>
        </form>
    </div>



</div>

<script>
function showStatusModal() {
    document.getElementById('status-modal').style.display = 'flex';
}

function closeStatusModal() {
    document.getElementById('status-modal').style.display = 'none';
}

async function submitStatus(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);

    // –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ "custom" - –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ç–µ–∫—Å—Ç –∑ input
    const locationSelect = form.querySelector('[name="new_location"]');
    if (locationSelect.value === 'custom') {
        const customLocation = document.getElementById('custom-location').value;
        formData.set('new_location', customLocation);
    }

    try {
        const response = await fetch('/api/equipment/{{ equipment.id }}/update_status', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (result.success) {
            alert(result.message);
            window.location.reload();
        } else {
            alert('–ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

document.getElementById('status-modal').addEventListener('click', function(e) {
    if (e.target === this) closeStatusModal();
});
</script>

<!-- –ü–ï–†–ï–ú–Ü–°–¢–ò–¢–ò –ë–ï–ó –ê–ö–¢–£ -->
<div id="move-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%;">
        <h2 style="margin: 0 0 20px 0;">
            {% if equipment.status == 'available' %}
            ‚ÜóÔ∏è –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –±–µ–∑ –∞–∫—Ç—É
            {% else %}
            ‚ÜôÔ∏è –î–µ–º–æ–Ω—Ç—É–≤–∞—Ç–∏ –±–µ–∑ –∞–∫—Ç—É
            {% endif %}
        </h2>

        <form id="move-form" onsubmit="submitMove(event)">
            <input type="hidden" name="action" id="move-action" value="">

            <!-- –ü–û–õ–Ø –î–õ–Ø –í–°–¢–ê–ù–û–í–õ–ï–ù–ù–Ø -->
            <div id="install-fields" style="display: none;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–°–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞ *</label>
                    <select name="well_id" required style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                        <option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω—É...</option>
                        {% for well in wells_list %}
                        <option value="{{ well.id }}">{{ well.number }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ú—ñ—Å—Ü–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è *</label>
                    <select name="installation_location" required style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                        <option value="">–í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ...</option>
                        <option value="–£—Å—Ç—å–µ">–£—Å—Ç—å–µ</option>
                        <option value="–ù–ö–¢">–ù–ö–¢</option>
                        <option value="–®–ª–µ–π—Ñ">–®–ª–µ–π—Ñ</option>
                        <option value="–ó–∞—Ç—Ä—É–±">–ó–∞—Ç—Ä—É–±</option>
                        <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
                    </select>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–°—Ç–∞–Ω –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</label>
                    <select name="condition" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                        <option value="working" {% if equipment.condition == 'working' %}selected{% endif %}>‚úÖ –†–æ–±–æ—á–µ</option>
                        <option value="needs_repair" {% if equipment.condition == 'needs_repair' %}selected{% endif %}>‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É</option>
                    </select>
                </div>
            </div>

            <!-- –ü–û–õ–Ø –î–õ–Ø –î–ï–ú–û–ù–¢–ê–ñ–£ -->
            <div id="remove-fields" style="display: none;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ö—É–¥–∏ –ø–µ—Ä–µ–º—ñ—â—É—î—Ç—å—Å—è</label>
                    <select name="location" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                        <option value="">–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (–∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º)</option>
                        <option value="–°–∫–ª–∞–¥">üì¶ –°–∫–ª–∞–¥</option>
                        <option value="–ú–∞–π—Å—Ç–µ—Ä–Ω—è">üîß –ú–∞–π—Å—Ç–µ—Ä–Ω—è</option>
                        <option value="–†–µ–º–æ–Ω—Ç">üõ†Ô∏è –†–µ–º–æ–Ω—Ç</option>
                        <option value="–ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è">‚ùÑÔ∏è –ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è</option>
                    </select>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ù–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å</label>
                    <select name="status" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                        <option value="available">üì¶ –ù–∞ —Å–∫–ª–∞–¥—ñ</option>
                        <option value="maintenance">üîß –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</option>
                        <option value="broken">‚ùå –ù–µ —Ä–æ–±–æ—á–µ</option>
                    </select>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–°—Ç–∞–Ω –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</label>
                    <select name="condition" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                        <option value="working" {% if equipment.condition == 'working' %}selected{% endif %}>‚úÖ –†–æ–±–æ—á–µ</option>
                        <option value="needs_repair" {% if equipment.condition == 'needs_repair' %}selected{% endif %}>‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É</option>
                        <option value="broken" {% if equipment.condition == 'broken' %}selected{% endif %}>‚ùå –ù–µ —Ä–æ–±–æ—á–µ</option>
                    </select>
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ü—Ä–∏–º—ñ—Ç–∫–∞</label>
                <textarea name="notes" rows="2" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–ü—Ä–∏–º—ñ—Ç–∫–∏ –¥–æ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è..."></textarea>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px;">
                    <input type="checkbox" name="no_document_confirmed" checked style="margin-right: 8px;">
                    ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—é —â–æ –∞–∫—Ç –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω
                </label>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeMoveModal()" style="padding: 10px 20px; border: none; border-radius: 8px; background: #6c757d; color: white; font-weight: 600; cursor: pointer;">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
                <button type="submit" style="padding: 10px 20px; border: none; border-radius: 8px; background: #007bff; color: white; font-weight: 600; cursor: pointer;">
                    –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏
                </button>
            </div>
        </form>
    </div>
</div>

<!-- –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è/–†–µ–º–æ–Ω—Ç -->
<div id="maintenance-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
        <h2 style="margin: 0 0 20px 0;">üîß –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è/–†–µ–º–æ–Ω—Ç</h2>
        <form id="maintenance-form" onsubmit="submitMaintenance(event)">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–¢–∏–ø *</label>
                <select name="maintenance_type" required
                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    <option value="">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø...</option>
                    <option value="–¢–µ—Ö–Ω—ñ—á–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è">–¢–µ—Ö–Ω—ñ—á–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è (–¢–û)</option>
                    <option value="–†–µ–º–æ–Ω—Ç">–†–µ–º–æ–Ω—Ç</option>
                    <option value="–ö–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è">–ö–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è</option>
                    <option value="–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞">–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</option>
                    <option value="–ó–∞–º—ñ–Ω–∞ –¥–µ—Ç–∞–ª–µ–π">–ó–∞–º—ñ–Ω–∞ –¥–µ—Ç–∞–ª–µ–π</option>
                    <option value="–ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è">–ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è</option>
                    <option value="–†–æ–∑–∫–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è">–†–æ–∑–∫–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è</option>
                </select>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–û–ø–∏—Å —Ä–æ–±—ñ—Ç *</label>
                <textarea name="description" required rows="3"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–©–æ —Å–∞–º–µ –±—É–ª–æ –∑—Ä–æ–±–ª–µ–Ω–æ..."></textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–î–∞—Ç–∞ *</label>
                    <input type="datetime-local" name="maintenance_date" required
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ù–∞—Å—Ç—É–ø–Ω–µ –¢–û</label>
                    <input type="date" name="next_maintenance_date"
                           style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
    <div>
        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å</label>
        <input type="text" id="performed_by" name="performed_by" placeholder="–Ü–º'—è –≤–∏–∫–æ–Ω–∞–≤—Ü—è"
               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
        <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
            –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: <span id="current-user">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
        </small>
    </div>
    <div>
        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–í–∞—Ä—Ç—ñ—Å—Ç—å (–≥—Ä–Ω)</label>
        <input type="number" name="cost" step="0.01" value="0"
            style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
    </div>
</div>

<script>
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function showMaintenanceModal() {
    document.getElementById('maintenance-modal').style.display = 'flex';

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const performedByField = document.getElementById('performed_by');
    if (!performedByField.value.trim() || performedByField.value === '-') {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–º—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–µ—Å—Å–∏–∏/–∫—É–∫–æ–≤
        performedByField.value = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
    }
}
</script>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ó–Ω–∞–π–¥–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏</label>
                <textarea name="issues_found" rows="2"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–Ø–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏ –±—É–ª–∏ –≤–∏—è–≤–ª–µ–Ω—ñ..."></textarea>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–í–∂–∏—Ç—ñ –∑–∞—Ö–æ–¥–∏</label>
                <textarea name="actions_taken" rows="2"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–Ø–∫—ñ –∑–∞—Ö–æ–¥–∏ –±—É–ª–∏ –≤–∂–∏—Ç—ñ..."></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ü—Ä–∏–º—ñ—Ç–∫–∏</label>
                <textarea name="notes" rows="2"
                          style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;"
                          placeholder="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏..."></textarea>
            </div>

            <div style="padding: 15px; background: #e7f3ff; border-left: 4px solid #007bff; border-radius: 6px; margin: 20px 0; font-size: 14px;">
                <strong>‚ÑπÔ∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:</strong><br>
                ‚Ä¢ <strong>–¢–∏–ø —Ä–∞–±–æ—Ç</strong> - –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞<br>
                ‚Ä¢ <strong>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</strong> - —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–¥–µ–ª–∞–Ω–æ<br>
                ‚Ä¢ <strong>–î–∞—Ç–∞</strong> - –∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ<br>
                <em>–û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º–∏</em>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeMaintenanceModal()"
                        style="padding: 10px 20px; border: none; border-radius: 8px; background: #6c757d; color: white; font-weight: 600; cursor: pointer;">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
                <button type="submit"
                        style="padding: 10px 20px; border: none; border-radius: 8px; background: #28a745; color: white; font-weight: 600; cursor: pointer;">
                    –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è
function showMoveModal() {
    const status = '{{ equipment.status }}';
    const modal = document.getElementById('move-modal');
    const actionInput = document.getElementById('move-action');
    const installFields = document.getElementById('install-fields');
    const removeFields = document.getElementById('remove-fields');

    if (status === 'available') {
        actionInput.value = 'install';
        installFields.style.display = 'block';
        removeFields.style.display = 'none';
    } else {
        actionInput.value = 'remove';
        installFields.style.display = 'none';
        removeFields.style.display = 'block';
    }

    modal.style.display = 'flex';
}

function closeMoveModal() {
    document.getElementById('move-modal').style.display = 'none';
}

async function submitMove(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);

    // –í–ê–õ–Ü–î–ê–¶–Ü–Ø: —è–∫—â–æ –¥—ñ—è = install, well_id –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π
    const action = formData.get('action');
    const wellId = formData.get('well_id');
    const installLocation = formData.get('installation_location');

    if (action === 'install') {
        if (!wellId || wellId === '') {
            alert('–í–∏–±–µ—Ä—ñ—Ç—å —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω—É!');
            return;
        }
        if (!installLocation || installLocation === '') {
            alert('–í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è!');
            return;
        }
    }

    try {
        const response = await fetch('/api/equipment/{{ equipment.id }}/move', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (result.success) {
            alert(result.message);
            window.location.reload();
        } else {
            alert('–ü–æ–º–∏–ª–∫–∞: ' + (result.detail || JSON.stringify(result)));
        }
    } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
function showMaintenanceModal() {
    document.getElementById('maintenance-modal').style.display = 'flex';
}

function closeMaintenanceModal() {
    document.getElementById('maintenance-modal').style.display = 'none';
}

async function submitMaintenance(event) {
    event.preventDefault();


   const form = event.target;
    const formData = new FormData(form);

    // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø–æ–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ FastAPI
    formData.delete('issues_found');
    formData.delete('actions_taken');
    formData.delete('notes');
    formData.delete('next_maintenance_date'); // –≠—Ç–æ –ø–æ–ª–µ —Ç–æ–∂–µ –Ω–µ—Ç –≤ API

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º cost - –µ—Å–ª–∏ –ø—É—Å—Ç–æ, —Å—Ç–∞–≤–∏–º 0
    const costValue = formData.get('cost');
    if (!costValue || costValue.trim() === '') {
        formData.set('cost', '0');
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
    const dateInput = form.querySelector('[name="maintenance_date"]');
    if (!dateInput.value) {
        const now = new Date();
        const nowStr = now.toISOString().slice(0, 16);
        dateInput.value = nowStr;
        formData.set('maintenance_date', nowStr);
    }


    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    const typeSelect = form.querySelector('[name="maintenance_type"]');
    const descriptionTextarea = form.querySelector('[name="description"]');

    let errors = [];
    if (!typeSelect.value) errors.push("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞–±–æ—Ç");
    if (!descriptionTextarea.value.trim()) errors.push("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç");

    if (errors.length > 0) {
        alert("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:\n" + errors.join("\n"));
        return;
    }

    try {
        const response = await fetch('/api/equipment/{{ equipment.id }}/add_maintenance', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
            alert('‚úÖ –ó–∞–ø–∏—Å –ø—Ä–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞–Ω–æ!');
            window.location.reload();
        } else {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            let errorMsg = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';

            if (result.detail) {
                errorMsg = result.detail;
            } else if (result.message) {
                errorMsg = result.message;
            } else if (typeof result === 'string') {
                errorMsg = result;
            } else if (result.error) {
                errorMsg = result.error;
            }

            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + errorMsg);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –í–∏–¥–∞–ª–µ–Ω–Ω—è
async function deleteEquipment() {
    try {
        const response = await fetch('/api/equipment/{{ equipment.id }}', {
            method: 'DELETE'
        });

        const result = await response.json();

        if (result.success) {
            alert(result.message);
            window.location.href = '/equipment';
        } else {
            alert('–ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω –ø–æ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º–∏
document.getElementById('move-modal').addEventListener('click', function(e) {
    if (e.target === this) closeMoveModal();
});
document.getElementById('maintenance-modal').addEventListener('click', function(e) {
    if (e.target === this) closeMaintenanceModal();
});


// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
function showEditModal() {
    document.getElementById('edit-modal').style.display = 'flex';
}

function closeEditModal() {
    document.getElementById('edit-modal').style.display = 'none';
}

async function submitEdit(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);

    try {
        const response = await fetch('/api/equipment/{{ equipment.id }}/update', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (result.success) {
            alert(result.message);
            window.location.reload();
        } else {
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ edit-modal –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
document.getElementById('edit-modal').addEventListener('click', function(e) {
    if (e.target === this) closeEditModal();
});

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
function editMaintenanceRecord(maintenanceId) {
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–∑–¥–µ—Å—å –Ω—É–∂–µ–Ω –∑–∞–ø—Ä–æ—Å –∫ API –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞)
    // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å fetch –∑–∞–ø—Ä–æ—Å
    showEditMaintenanceModal(maintenanceId);
}

function showEditMaintenanceModal(maintenanceId) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
    fetch(`/api/maintenance/${maintenanceId}`)
        .then(response => response.json())
        .then(data => {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('edit-maintenance-id').value = data.id;
            document.getElementById('edit-maintenance-type').value = data.maintenance_type;
            document.getElementById('edit-description').value = data.description;

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –¥–ª—è input[type="datetime-local"]
            if (data.maintenance_date) {
                const date = new Date(data.maintenance_date);
                const formattedDate = date.toISOString().slice(0, 16);
                document.getElementById('edit-maintenance-date').value = formattedDate;
            }

            if (data.next_maintenance_date) {
                const nextDate = new Date(data.next_maintenance_date);
                document.getElementById('edit-next-date').value = nextDate.toISOString().slice(0, 10);
            }

            document.getElementById('edit-performed-by').value = data.performed_by || '';
            document.getElementById('edit-cost').value = data.cost || '0';
            document.getElementById('edit-issues').value = data.issues_found || '';
            document.getElementById('edit-actions').value = data.actions_taken || '';
            document.getElementById('edit-notes').value = data.notes || '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('edit-maintenance-modal').style.display = 'flex';
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏');
        });
}

function closeEditMaintenanceModal() {
    document.getElementById('edit-maintenance-modal').style.display = 'none';
}

async function submitEditMaintenance(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);
    const maintenanceId = formData.get('maintenance_id');

    try {
        const response = await fetch(`/api/maintenance/${maintenanceId}/update`, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
            alert('‚úÖ –ó–∞–ø–∏—Å –ø—Ä–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ!');
            window.location.reload();
        } else {
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
document.getElementById('edit-maintenance-modal').addEventListener('click', function(e) {
    if (e.target === this) closeEditMaintenanceModal();
});

// –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
async function deleteMaintenanceRecord(maintenanceId, maintenanceName) {
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
    if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å –ø—Ä–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è?\n"${maintenanceName}"\n\n–¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.`)) {
        return;
    }

    try {
        const response = await fetch(`/api/maintenance/${maintenanceId}/delete`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (response.ok && result.success) {
            alert('‚úÖ –ó–∞–ø–∏—Å –ø—Ä–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–æ!');
            window.location.reload();
        } else {
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
function editInstallationRecord(installationId) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
    fetch(`/api/installation/${installationId}`)
        .then(response => response.json())
        .then(data => {
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            showEditInstallationModal(data);
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏');
        });
}
// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
function editInstallationRecord(installationId) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
    fetch(`/api/installation/${installationId}`)
        .then(response => response.json())
        .then(data => {
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            showEditInstallationModal(data);
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏');
        });
}

function showEditInstallationModal(data) {
    // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const modalHtml = `
        <div id="edit-installation-modal" style="display: flex; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%;">
                <h2 style="margin: 0 0 20px 0;">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</h2>
                <form id="edit-installation-form" onsubmit="submitEditInstallation(event, ${data.id})">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–î–∞—Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</label>
                        <input type="datetime-local" name="installed_at" value="${formatDateForInput(data.installed_at)}"
                               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–î–∞—Ç–∞ –¥–µ–º–æ–Ω—Ç–∞–∂—É</label>
                        <input type="datetime-local" name="removed_at" value="${data.removed_at ? formatDateForInput(data.removed_at) : ''}"
                               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ú—ñ—Å—Ü–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</label>
                        <select name="installation_location" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                            <option value="">–í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ...</option>
                            <option value="–£—Å—Ç—å–µ" ${data.installation_location === '–£—Å—Ç—å–µ' ? 'selected' : ''}>–£—Å—Ç—å–µ</option>
                            <option value="–ù–ö–¢" ${data.installation_location === '–ù–ö–¢' ? 'selected' : ''}>–ù–ö–¢</option>
                            <option value="–®–ª–µ–π—Ñ" ${data.installation_location === '–®–ª–µ–π—Ñ' ? 'selected' : ''}>–®–ª–µ–π—Ñ</option>
                            <option value="–ó–∞—Ç—Ä—É–±" ${data.installation_location === '–ó–∞—Ç—Ä—É–±' ? 'selected' : ''}>–ó–∞—Ç—Ä—É–±</option>
                            <option value="–Ü–Ω—à–µ" ${data.installation_location === '–Ü–Ω—à–µ' ? 'selected' : ''}>–Ü–Ω—à–µ</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ü—Ä–∏–º—ñ—Ç–∫–∏</label>
                        <textarea name="notes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">${data.notes || ''}</textarea>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" onclick="closeEditInstallationModal()"
                                style="padding: 10px 20px; border: none; border-radius: 8px; background: #6c757d; color: white; font-weight: 600; cursor: pointer;">
                            –°–∫–∞—Å—É–≤–∞—Ç–∏
                        </button>
                        <button type="submit"
                                style="padding: 10px 20px; border: none; border-radius: 8px; background: #28a745; color: white; font-weight: 600; cursor: pointer;">
                            –ó–±–µ—Ä–µ–≥—Ç–∏
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    const modalDiv = document.createElement('div');
    modalDiv.innerHTML = modalHtml;
    document.body.appendChild(modalDiv);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    window.closeEditInstallationModal = function() {
        document.getElementById('edit-installation-modal').remove();
    };
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è input[type="datetime-local"]
function formatDateForInput(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toISOString().slice(0, 16);
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
async function deleteInstallationRecord(installationId, wellNumber) {
    if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å –ø—Ä–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω—ñ ${wellNumber}?\n\n–¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.`)) {
        return;
    }

    try {
        const response = await fetch(`/api/installation/${installationId}/delete`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (response.ok && result.success) {
            alert('‚úÖ –ó–∞–ø–∏—Å –ø—Ä–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–æ!');
            window.location.reload();
        } else {
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
async function submitEditInstallation(event, installationId) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    try {
        const response = await fetch(`/api/installation/${installationId}/update`, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
            alert('‚úÖ –ó–∞–ø–∏—Å –ø—Ä–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ!');
            window.location.reload();
        } else {
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}
function showEditInstallationModal(data) {
    // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const modalHtml = `
        <div id="edit-installation-modal" style="display: flex; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%;">
                <h2 style="margin: 0 0 20px 0;">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</h2>
                <form id="edit-installation-form" onsubmit="submitEditInstallation(event, ${data.id})">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–î–∞—Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</label>
                        <input type="datetime-local" name="installed_at" value="${formatDateForInput(data.installed_at)}"
                               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–î–∞—Ç–∞ –¥–µ–º–æ–Ω—Ç–∞–∂—É</label>
                        <input type="datetime-local" name="removed_at" value="${data.removed_at ? formatDateForInput(data.removed_at) : ''}"
                               style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ú—ñ—Å—Ü–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</label>
                        <select name="installation_location" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">
                            <option value="">–í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ...</option>
                            <option value="–£—Å—Ç—å–µ" ${data.installation_location === '–£—Å—Ç—å–µ' ? 'selected' : ''}>–£—Å—Ç—å–µ</option>
                            <option value="–ù–ö–¢" ${data.installation_location === '–ù–ö–¢' ? 'selected' : ''}>–ù–ö–¢</option>
                            <option value="–®–ª–µ–π—Ñ" ${data.installation_location === '–®–ª–µ–π—Ñ' ? 'selected' : ''}>–®–ª–µ–π—Ñ</option>
                            <option value="–ó–∞—Ç—Ä—É–±" ${data.installation_location === '–ó–∞—Ç—Ä—É–±' ? 'selected' : ''}>–ó–∞—Ç—Ä—É–±</option>
                            <option value="–Ü–Ω—à–µ" ${data.installation_location === '–Ü–Ω—à–µ' ? 'selected' : ''}>–Ü–Ω—à–µ</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">–ü—Ä–∏–º—ñ—Ç–∫–∏</label>
                        <textarea name="notes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;">${data.notes || ''}</textarea>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" onclick="closeEditInstallationModal()"
                                style="padding: 10px 20px; border: none; border-radius: 8px; background: #6c757d; color: white; font-weight: 600; cursor: pointer;">
                            –°–∫–∞—Å—É–≤–∞—Ç–∏
                        </button>
                        <button type="submit"
                                style="padding: 10px 20px; border: none; border-radius: 8px; background: #28a745; color: white; font-weight: 600; cursor: pointer;">
                            –ó–±–µ—Ä–µ–≥—Ç–∏
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    const modalDiv = document.createElement('div');
    modalDiv.innerHTML = modalHtml;
    document.body.appendChild(modalDiv);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    window.closeEditInstallationModal = function() {
        document.getElementById('edit-installation-modal').remove();
    };
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è input[type="datetime-local"]
function formatDateForInput(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toISOString().slice(0, 16);
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
async function deleteInstallationRecord(installationId, wellNumber) {
    if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å –ø—Ä–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω—ñ ${wellNumber}?\n\n–¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.`)) {
        return;
    }

    try {
        const response = await fetch(`/api/installation/${installationId}/delete`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (response.ok && result.success) {
            alert('‚úÖ –ó–∞–ø–∏—Å –ø—Ä–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–æ!');
            window.location.reload();
        } else {
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
async function submitEditInstallation(event, installationId) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    try {
        const response = await fetch(`/api/installation/${installationId}/update`, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
            alert('‚úÖ –ó–∞–ø–∏—Å –ø—Ä–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ!');
            window.location.reload();
        } else {
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (result.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
    }
}



</script>




{% endblock %}