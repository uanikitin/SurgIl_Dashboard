{% extends "base.html" %}

{% block title %}–°–£–†–ì–ò–õ ¬∑ –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è{% endblock %}

{% block extra_head %}
<style>
/* === –ó–∞–≥–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ === */
.equipment-page {
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.page-header h1 {
    margin: 0;
    font-size: 32px;
    color: #2c3e50;
}

.btn-add {
    padding: 12px 24px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: background 0.2s;
}

.btn-add:hover {
    background: #218838;
}

/* === –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ === */
.stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    text-align: center;
}

.stat-card__value {
    font-size: 36px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 8px;
}

.stat-card__label {
    font-size: 14px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-card--installed .stat-card__value { color: #28a745; }
.stat-card--available .stat-card__value { color: #007bff; }
.stat-card--maintenance .stat-card__value { color: #ffc107; }

/* === –§—ñ–ª—å—Ç—Ä–∏ === */
.filters-row {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 30px;
}

.filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.filter-group label {
    font-size: 13px;
    font-weight: 600;
    color: #495057;
}

.filter-group select,
.filter-group input {
    padding: 10px 12px;
    border: 1px solid #ced4da;
    border-radius: 6px;
    font-size: 14px;
}

.btn-filter {
    padding: 10px 20px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
}

.btn-filter:hover {
    background: #0056b3;
}

.btn-reset {
    padding: 10px 20px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
}

.btn-reset:hover {
    background: #5a6268;
}

/* === –¢–∞–±–ª–∏—Ü—è –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è === */
.equipment-table-wrap {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    overflow: hidden;
}

.equipment-table {
    width: 100%;
    border-collapse: collapse;
}

.equipment-table thead {
    background: #f8f9fa;
}

.equipment-table th {
    padding: 16px;
    text-align: left;
    font-size: 13px;
    font-weight: 700;
    color: #495057;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #dee2e6;
}

.equipment-table td {
    padding: 16px;
    border-bottom: 1px solid #f1f3f5;
    font-size: 14px;
    color: #212529;
}

.equipment-table tbody tr {
    transition: background 0.2s;
    cursor: pointer;
}

.equipment-table tbody tr:hover {
    background: #f8f9fa;
}

/* === –°—Ç–∞—Ç—É—Å–∏ —Ç–∞ —Å—Ç–∞–Ω–∏ === */
.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
}

.status-badge--installed {
    background: #d4edda;
    color: #155724;
}

.status-badge--available {
    background: #d1ecf1;
    color: #0c5460;
}

.status-badge--maintenance {
    background: #fff3cd;
    color: #856404;
}

.status-badge--broken {
    background: #f8d7da;
    color: #721c24;
}

.condition-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    font-weight: 600;
}

.condition-badge--working { color: #28a745; }
.condition-badge--broken { color: #dc3545; }
.condition-badge--needs_repair { color: #ffc107; }

/* === –Ü–∫–æ–Ω–∫–∏ === */
.icon {
    font-size: 14px;
}

/* === –ü–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω === */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.empty-state__icon {
    font-size: 64px;
    margin-bottom: 20px;
    opacity: 0.3;
}

.empty-state__text {
    font-size: 18px;
    margin-bottom: 10px;
}

.empty-state__hint {
    font-size: 14px;
    color: #adb5bd;
}
</style>
{% endblock %}

{% block content %}
<nav class="top-nav">
  <div class="top-nav-inner">
    <a href="/visual" class="top-nav-item">üìä –î–∞—à–±–æ—Ä–¥</a>
    <a href="/documents" class="top-nav-item">üìÑ –ê–∫—Ç—ã</a>
    <a href="/admin/reagents" class="top-nav-item">üß™ –†–µ–∞–≥–µ–Ω—Ç—ã</a>
    <a href="/equipment" class="top-nav-item active">‚öôÔ∏è –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</a>
    <a href="/admin/users" class="top-nav-item">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
  </div>
</nav>

<div class="equipment-page">

    {# === HEADER === #}
    <div class="page-header">
        <h1>üîß –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h1>
        <div style="display: flex; gap: 10px;">
            <a href="/admin/lora-sensors" class="btn-add" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <span>üì°</span>
                <span>–ú–∞–Ω–æ–º–µ—Ç—Ä—ã LoRa</span>
            </a>
            <a href="/equipment/import" class="btn-add" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <span>üìä</span>
                <span>–Ü–º–ø–æ—Ä—Ç –∑ Excel</span>
            </a>
            <a href="/equipment/add" class="btn-add">
                <span>+</span>
                <span>–î–æ–¥–∞—Ç–∏ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</span>
            </a>
        </div>
    </div>

    {# === –°–¢–ê–¢–ò–°–¢–ò–ö–ê === #}
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-card__value">{{ stats.total }}</div>
            <div class="stat-card__label">–í—Å—å–æ–≥–æ</div>
        </div>
        <div class="stat-card stat-card--installed">
            <div class="stat-card__value">{{ stats.installed }}</div>
            <div class="stat-card__label">–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
        </div>
        <div class="stat-card stat-card--available">
            <div class="stat-card__value">{{ stats.available }}</div>
            <div class="stat-card__label">–ù–∞ —Å–∫–ª–∞–¥—ñ</div>
        </div>
        <div class="stat-card stat-card--maintenance">
            <div class="stat-card__value">{{ stats.maintenance }}</div>
            <div class="stat-card__label">–û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</div>
        </div>
    </div>

    {# === –§–Ü–õ–¨–¢–†–ò === #}
    <div class="filters-row">
        <form method="get" action="/equipment">
            <div class="filters-grid">
                <div class="filter-group">
                    <label>–¢–∏–ø –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</label>
                    <select name="equipment_type">
                        <option value="">–í—Å—ñ —Ç–∏–ø–∏</option>
                        {% for type in equipment_types %}
                        <option value="{{ type }}" {% if selected_type == type %}selected{% endif %}>
                            {{ type }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label>–°—Ç–∞—Ç—É—Å</label>
                    <select name="status">
                        <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                        <option value="available" {% if selected_status == 'available' %}selected{% endif %}>–ù–∞ —Å–∫–ª–∞–¥—ñ</option>
                        <option value="installed" {% if selected_status == 'installed' %}selected{% endif %}>–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</option>
                        <option value="maintenance" {% if selected_status == 'maintenance' %}selected{% endif %}>–û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</option>
                        <option value="broken" {% if selected_status == 'broken' %}selected{% endif %}>–ó–ª–∞–º–∞–Ω–æ</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>–°—Ç–∞–Ω</label>
                    <select name="condition">
                        <option value="">–í—Å—ñ —Å—Ç–∞–Ω–∏</option>
                        <option value="working" {% if selected_condition == 'working' %}selected{% endif %}>–†–æ–±–æ—á–µ</option>
                        <option value="broken" {% if selected_condition == 'broken' %}selected{% endif %}>–ù–µ —Ä–æ–±–æ—á–µ</option>
                        <option value="needs_repair" {% if selected_condition == 'needs_repair' %}selected{% endif %}>–ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>–ü–æ—à—É–∫</label>
                    <input
                        type="text"
                        name="search"
                        placeholder="–ù–∞–∑–≤–∞ –∞–±–æ —Å–µ—Ä—ñ–π–Ω–∏–π ‚Ññ..."
                        value="{{ search_query }}"
                    >
                </div>

                <div class="filter-group">
                    <button type="submit" class="btn-filter">üîç –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
                </div>

                <div class="filter-group">
                    <a href="/equipment" class="btn-reset">–°–∫–∏–Ω—É—Ç–∏</a>
                </div>
            </div>
        </form>
    </div>

    {# === –¢–ê–ë–õ–ò–¶–Ø === #}
    <div class="equipment-table-wrap">
        {% if equipment_list %}
        <table class="equipment-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ù–∞–∑–≤–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–°–µ—Ä—ñ–π–Ω–∏–π ‚Ññ</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–°—Ç–∞–Ω</th>
                    <th>–õ–æ–∫–∞—Ü—ñ—è</th>
                    <th>–î—ñ—ó</th>
                </tr>
            </thead>
            <tbody>
    {% for eq in equipment_list %}
    <tr onclick="window.location.href='/equipment/view/{{ eq.id }}'">
        <td>{{ eq.id }}</td>
        <td>{{ eq.name }}</td>
        <td>{{ eq.equipment_type or '‚Äî' }}</td>
        <td><strong>{{ eq.serial_number or '‚Äî' }}</strong></td>
        <td>
            {% if eq.status == 'installed' %}
            <span class="status-badge status-badge--installed">
                <span class="icon">üü¢</span>
                –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
            </span>
            {% elif eq.status == 'available' %}
            <span class="status-badge status-badge--available">
                <span class="icon">üì¶</span>
                –ù–∞ —Å–∫–ª–∞–¥—ñ
            </span>
            {% elif eq.status == 'maintenance' %}
            <span class="status-badge status-badge--maintenance">
                <span class="icon">üîß</span>
                –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
            </span>
            {% elif eq.status == 'broken' %}
            <span class="status-badge status-badge--broken">
                <span class="icon">‚ùå</span>
                –ó–ª–∞–º–∞–Ω–æ
            </span>
            {% else %}
            <span class="status-badge">{{ eq.status }}</span>
            {% endif %}
        </td>
        <td>
            {% if eq.condition == 'working' %}
            <span class="condition-badge condition-badge--working">
                <span>‚úÖ</span>
                –†–æ–±–æ—á–µ
            </span>
            {% elif eq.condition == 'broken' %}
            <span class="condition-badge condition-badge--broken">
                <span>‚ùå</span>
                –ù–µ —Ä–æ–±–æ—á–µ
            </span>
            {% elif eq.condition == 'needs_repair' %}
            <span class="condition-badge condition-badge--needs_repair">
                <span>‚ö†Ô∏è</span>
                –ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É
            </span>
            {% else %}
            <span>‚Äî</span>
            {% endif %}
        </td>
        <td>{{ eq.current_location or '‚Äî' }}</td>
        <td onclick="event.stopPropagation()">
            <a href="/equipment/view/{{ eq.id }}" style="text-decoration: none; color: #007bff;">
                –î–µ—Ç–∞–ª—ñ ‚Üí
            </a>
        </td>
    </tr>
    {% endfor %}
</tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-state__icon">üì¶</div>
            <div class="empty-state__text">–û–±–ª–∞–¥–Ω–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>
            <div class="empty-state__hint">–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ –∞–±–æ –¥–æ–¥–∞–π—Ç–µ –Ω–æ–≤–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</div>
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}